# Biggest TODO's:
# @important NOTE: if adjacent band is used, we need to implement other mask, or use aclr as implemented in
# https://github.com/Radio-Spectrum/SHARC/commit/bbc92dc8a2a181a3d066b1792cb38836b6098d9a#diff-7b9d87e26b6c151185f5a87aa471a9e0f453364989acec14fe375eaae7910c14
# P452 path loss parameters
# use new AAS antenna model
# UE distribution

general:
    ###########################################################################
    # Number of simulation snapshots
    num_snapshots: 10000
    ###########################################################################
    # IMT link that will be simulated (DOWNLINK or UPLINK)
    imt_link: DOWNLINK
    ###########################################################################
    # The chosen system for sharing study
    # EESS_PASSIVE, FSS_SS, FSS_ES, FS, RAS, SINGLE_EARTH_STATION
    system: SINGLE_EARTH_STATION
    ###########################################################################
    # Compatibility scenario (co-channel and/or adjacent channel interference)
    enable_cochannel: true
    enable_adjacent_channel: false
    ###########################################################################
    # Seed for random number generator
    seed: 33
    ###########################################################################
    # if FALSE, then a new output directory is created
    overwrite_output: FALSE
    # output destination folder - this is relative SHARC/sharc directory
    output_dir  : campaigns/imt_hotspot_metsat_es_7450MHz/output/
    ###########################################################################
    # output folder prefix
    output_dir_prefix  : output_imt_metsat_es_7450MHz_<subs>

imt:
    # Minimum 2D separation distance from BS to UE [m]
    # NOTE: From 3GPP TS 38.104 v.18.6.0, based on BS class
    minimum_separation_distance_bs_ue: 5
    # Defines if IMT service is the interferer or interfered-with service
    #   TRUE: IMT suffers interference
    #   FALSE : IMT generates interference
    interfered_with: FALSE
    # IMT center frequency [MHz]
    # NOTE: this parameter is updated by the script to be eq to system frequency
    frequency: -1
    # IMT bandwidth [MHz]
    # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 4
    bandwidth: 100
    # IMT resource block bandwidth [MHz]
    # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2, Note 3
    rb_bandwidth: 0.180
    # @important NOTE: if adjacent band is used, we need to implement other mask
    spectral_mask: IMT-2020
    # level of spurious emissions [dBm/MHz]
    # NOTE: could be -13 (Class A) or -30 (class B)
    # @important NOTE: if unwanted emissions are to be used,
    # spurious emission start frequency needs to be set on the new spectral mask
    spurious_emissions: -13
    # Defines the antenna model to be used in compatibility studies between
    # IMT and other services in adjacent band
    # Possible values: SINGLE_ELEMENT, BEAMFORMING
    adjacent_antenna_model: BEAMFORMING
    # NOTE: assumed guard band ratio
    guard_band_ratio: 0.1
    # Network topology parameters.
    topology:
        # Topology Type. Possible values are "MACROCELL", "HOTSPOT", "SINGLE_BS"
        # "INDOOR"
        type: HOTSPOT
        # Macrocell Topology parameters. Relevant when imt.topology.type == "MACROCELL"
        hotspot:
            # Inter-site distance in macrocell network topology [m]
            # NOTE: From Annex 4.2 to Document 5D/413-E, TABLE 6-1, Note 3
            # 300 * 3 / 2 = 450
            intersite_distance: 450
            # Enable wrap around.
            wrap_around: true
            # Number of clusters in macro cell topology
            num_clusters: 1
            ###########################################################################
            # Number of hotspots per macro cell (sector)
            num_hotspots_per_cell: 3
            ###########################################################################
            # Maximum 2D distance between hotspot and UE [m]
            # This is the hotspot radius
            max_dist_hotspot_ue: 60
            ###########################################################################
            # Minimum 2D distance between macro cell base station and hotspot [m]
            min_dist_bs_hotspot: 1
    # Base station parameters
    bs:
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Section 6
        # For wide area, .2
        # For smaller area, max. of .5
        load_probability: .2
        # Conducted power per antenna element [dBm/bandwidth]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10 (1.9)
        # Macro (sub)urban = 22
        # Small cell indoor/Micro urban = 16
        conducted_power: 16
        # Base station height [m]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-1
        # Urban/Suburban macro: 18m urban, 20m suburban
        # Small cell (outdoor)/Micro cell: 6m
        # Indoor (small cell): 3m
        height: 6
        # Base station noise figure [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 4
        # Wide area: 6
        # Medium: 11
        # Local: 14
        noise_figure: 11
        # Base station array ohmic loss  [dB]
        # NOTE: Table 10 Note 2 specifies element_gain already includes ohmic loss
        ohmic_loss: 0
        # Base Station Antenna parameters:
        antenna:
            # If normalization of M2101 should be applied for BS
            normalization: FALSE
            # Radiation pattern of each antenna element
            # Possible values: "M2101", "F1336", "FIXED"
            # TODO: use AAS extended model
            element_pattern: M2101
            # Minimum array gain for the beamforming antenna [dBi]
            minimum_array_gain: -200
            # mechanical downtilt [degrees]
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            downtilt: 10
            # BS/UE maximum transmit/receive element gain [dBi]
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            element_max_g: 6.4
            # BS/UE horizontal 3dB beamwidth of single element [degrees]
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            element_phi_3db: 90
            # BS/UE vertical 3dB beamwidth of single element [degrees]
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            element_theta_3db: 65
            # BS/UE number of rows in antenna array
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            n_rows: 8
            # BS/UE number of columns in antenna array
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            n_columns: 8
            # BS/UE array horizontal element spacing (d/lambda)
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            element_horiz_spacing: 0.5
            # BS/UE array vertical element spacing (d/lambda)
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            # NOTE: Small cell outdoor/micro urban uses = 0.7
            # NOTE: With new antenna model, macrocell should = 2.1
            element_vert_spacing: 0.7
            # BS/UE front to back ratio of single element [dB]
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            element_am: 30
            # BS/UE single element vertical sidelobe attenuation [dB]
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 10
            element_sla_v: 30
            # Multiplication factor k that is used to adjust the single-element pattern.
            # According to Report ITU-R M.[IMT.AAS], this may give a closer match of the 
            # side lobes when beamforming is assumed in adjacent channel.
            #       Original value: 12 (Rec. ITU-R M.2101)
            # NOTE: assumed
            multiplication_factor: 12

    ue:
        # Number of UEs that are allocated to each cell within handover margin.
        # Remember that in macrocell network each base station has 3 cells (sectors)
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        k: 3
        # Multiplication factor that is used to ensure that the sufficient number
        # of UE's will distributed throughout ths system area such that the number
        # of K users is allocated to each cell. Normally, this values varies
        # between 2 and 10 according to the user drop method
        # NOTE: assumed
        k_m: 1
        # Percentage of indoor UE's [%]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        indoor_percent: 70
        # Regarding the distribution of active UE's over the cell area, this
        # parameter states how the UEs will be distributed
        # Possible values: UNIFORM : UEs will be uniformly distributed within the
        #                            whole simulation area. Not applicable to
        #                            hotspots.
        #                  ANGLE_AND_DISTANCE : UEs will be distributed following
        #                                   given distributions for angle and
        #                                   distance. In this case, these must be
        #                                   defined later.
        distribution_type: ANGLE_AND_DISTANCE
        # Regarding the distribution of active UE's over the cell area, this
        # parameter models the distance between UE's and BS.
        # Possible values: RAYLEIGH, UNIFORM
        distribution_distance: UNIFORM
        # Regarding the distribution of active UE's over the cell area, this
        # parameter models the azimuth between UE and BS (within ±60° range).
        # Possible values: NORMAL, UNIFORM
        distribution_azimuth: NORMAL
        # Power control algorithm
        # tx_power_control = "ON",power control On
        # tx_power_control = "OFF",power control Off
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        tx_power_control: ON
        # Power per RB used as target value [dBm]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        # Macrocell: -92.2
        # Micro/indoor: -87.2
        p_o_pusch: -87.2
        # Alfa is the balancing factor for UEs with bad channel
        # and UEs with good channel
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        alpha: 0.8
        # Maximum UE transmit power [dBm]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        p_cmax: 23
        # UE power dynamic range [dB]
        # The minimum transmit power of a UE is (p_cmax - dynamic_range)
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 4
        power_dynamic_range: 56
        # UE height [m]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        height: 1.5
        # User equipment noise figure [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 4
        noise_figure: 13
        # User equipment feed loss [dB]
        ohmic_loss: 0
        # User equipment body loss [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
        body_loss: 4
        # NOTE: UE antenna radiation pattern is isotropic
        antenna:
            # If normalization of M2101 should be applied for UE
            normalization: FALSE
            # Radiation pattern of each antenna element
            # Possible values: "M2101", "F1336", "FIXED"
            element_pattern: FIXED
            # Minimum array gain for the beamforming antenna [dBi]
            minimum_array_gain: -200
            # BS/UE maximum transmit/receive element gain [dBi]
            #                           = 15, for M.2292
            # default: element_max_g = 5, for M.2101
            #                           = -3, for M.2292
            # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 6-2
            element_max_g: -4
            # BS/UE horizontal 3dB beamwidth of single element [degrees]
            element_phi_3db: 180
            # BS/UE vertical 3dB beamwidth of single element [degrees]
            element_theta_3db: 360
            # BS/UE number of rows in antenna array
            n_rows: 1
            # BS/UE number of columns in antenna array
            n_columns: 1
            # BS/UE front to back ratio of single element [dB]
            element_am: 25
            # BS/UE single element vertical sidelobe attenuation [dB]
            element_sla_v: 25
            # Multiplication factor k that is used to adjust the single-element pattern.
            # According to Report ITU-R M.[IMT.AAS], this may give a closer match of the 
            # side lobes when beamforming is assumed in adjacent channel.
            #       Original value: 12 (Rec. ITU-R M.2101)
            multiplication_factor: 12
    # Uplink parameters. Only needed when using uplink on imt
    uplink:
        # Uplink attenuation factor used in link-to-system mapping
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 3
        attenuation_factor: 0.4
        # Uplink minimum SINR of the code set [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 3
        sinr_min: -10
        # Uplink maximum SINR of the code set [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 3
        sinr_max: 22
    # Downlink parameters. Only needed when using donwlink on imt
    downlink:
        # Downlink attenuation factor used in link-to-system mapping
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 3
        attenuation_factor: 0.6
        # Downlink minimum SINR of the code set [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 3
        sinr_min: -10
        # Downlink maximum SINR of the code set [dB]
        # NOTE: From Annex 4.2 to Doc 5D/413-E, Table 3
        sinr_max: 30
    # Channel parameters
    # channel model, possible values are "FSPL" (free-space path loss),
    #                                    "CI" (close-in FS reference distance)
    #                                    "UMa" (Urban Macro - 3GPP)
    #                                    "UMi" (Urban Micro - 3GPP)
    #                                    "TVRO-URBAN"
    #                                    "TVRO-SUBURBAN"
    #                                    "ABG" (Alpha-Beta-Gamma)
    #                                    "P619"
    channel_model: UMi
    # If shadowing should be applied or not.
    # Used in propagation UMa
    shadowing: TRUE
    # Line of sight adjustment factor. Original value, per 3GPP, is 18
    los_adjustment_factor: 18


generic: &generic
  # tx powwer density just so simulator runs
  tx_power_density: -200
  # NOTE: Chosen from Annex 4.11 to Document 5D/413-E Section 5.2
  # – ITU-R P.452
  #     Prediction procedure for the evaluation of interference between stations on
  #     the surface of the Earth at frequencies above about 0.1 GHz
  # – ITU-R P.2001 (not in sharc)
  #     A general purpose wide-range terrestrial propagation model
  #     in the frequency range 30 MHz to 50 GHz
  channel_model: P452
    # NOTE: these parameters were taken considering Sao Paulo
  param_p452:
    # NOTE: public info
    atmospheric_pressure: 1017.0
    # NOTE: public info (20 Celsius)
    air_temperature: 293.15
    # NOTE: taken from P452 (Figure 13)
    N0: 352.58
    # NOTE: taken from P452 for worse delta_N Brazil is affected by (Figure 12)
    delta_N: 60

    percentage_p: 0.2

    # NOTE: approx. distance over land from the transmit and receive antennas to the coast (km)
    Dct: 100.0
    Dcr: 101.0

    # NOTE: height of transmitter and receiver
    Hte: 20
    Hre: 3
    # -23.17889, -46.63881
    tx_lat: -23.10
    rx_lat: -23.17
    polarization: "horizontal"
    clutter_loss: True
  geometry:
    # Antenna height [meters]
    height: 3
    azimuth:
      # Type of azimuth. May be "UNIFORM_DIST", "FIXED"
      type: FIXED
      fixed: 180
      # # uniform_dist:
      #   # uniform distribution lower bound [deg]
      #   min: -180
      #   # uniform distribution upper bound [deg]
      #   max: 180
    # Elevation angle [degrees]
    elevation:
      # Type of elevation. May be "UNIFORM_DIST", "FIXED"
      type: FIXED
      # Value of elevation when type == "FIXED" [deg]
      fixed: 3
      # # Limits of random uniform distribution when type == "UNIFORM_DIST"
      # uniform_dist:
      #   # uniform distribution lower bound [deg]
      #   min: 3
      #   # uniform distribution upper bound [deg]
      #   max: 10
    # Station 2d location [meters]:
    location:
      type: FIXED
      fixed:
        # NOTE: we're setting this on the script
        # x: 0
        y: 0

################## NEW TYPE
# - 7.450MHz - 7.550MHz (s-to-E)

# ITU-R SA.2488 Table 19
es_gso_sat_Q_7475MHz: &es_gso_sat_Q_7475MHz
  <<: *generic
  # Sensor center frequency [MHz]
  frequency: 7475
  # Sensor bandwidth [MHz]
  # NOTE: it can be verified that for all active satellites in
  # https://space.oscar.wmo.int/satellites/view/electro_goms
  # the bandwidth is 73000 kHz
  bandwidth: 73
  # System receive noise temperature [K]
  noise_temperature: 150
  antenna:
    pattern: ITU-R S.465
    # Earth station peak receive antenna gain [dBi]
    gain: 50
    itu_r_s_465:
      # Antenna diameter [m]
      diameter: 5

# # Almost the same as the previous ES, so no value:
# es_gso_sat_Q_7500MHz:
#   <<: *es_gso_sat_Q_7475MHz
#   # Sensor center frequency [MHz]
#   frequency: 7500

es_gso_sat_P:
  <<: *generic
  # Sensor center frequency [MHz]
  frequency: 7500
  # Sensor bandwidth [MHz]
  # NOTE: We weren't given the bandwidth 
  bandwidth: 50
  # System receive noise temperature [K]
  noise_temperature: 270
  antenna:
    pattern: ITU-R Reg. RR. Appendice 7 Annex 3
    # Earth station peak receive antenna gain [dBi]
    gain: 59
    itu_reg_rr_a7_3:
      # Antenna diameter [m]
      diameter: 13
